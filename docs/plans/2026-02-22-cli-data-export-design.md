# Design: Import CLI Data from functype

**Date:** 2026-02-22
**Status:** Proposed
**Scope:** functype + functype-mcp-server

## Problem

The MCP server maintains a manual copy of functype's CLI documentation data (~360 lines across `data.ts` and `full-interfaces.ts`). When functype adds or modifies types, the MCP server must be updated manually. The data is identical in both repos.

## Solution

Export functype's CLI data as a public subpath export (`functype/cli`) so the MCP server can import it directly instead of duplicating it.

## Why This Works Now

functype already builds `dist/cli/index.js` and `dist/cli/index.d.ts` as part of its normal build. The CLI code is already included in the published npm package (`"files": ["dist"]`). The only missing piece is an entry in the `exports` map.

## Changes

### functype

1. **Create `src/cli/exports.ts`** — barrel file re-exporting data (not the CLI runner):
   - `TYPES`, `INTERFACES`, `CATEGORIES`, `VERSION` from `./data`
   - `FULL_INTERFACES` from `./full-interfaces`
   - `TypeData`, `InterfaceData` type exports from `./data`

2. **Add export to `package.json`**:

   ```json
   "./cli": {
     "types": "./dist/cli/exports.d.ts",
     "import": "./dist/cli/exports.js",
     "default": "./dist/cli/exports.js"
   }
   ```

3. **Add `cli/exports` entry to `tsdown.config.ts`**:
   ```typescript
   "cli/exports": "src/cli/exports.ts"
   ```

### functype-mcp-server

1. **Replace `src/lib/docs/data.ts`** — remove all duplicated data, replace with re-exports:

   ```typescript
   export { TYPES, INTERFACES, CATEGORIES, VERSION, FULL_INTERFACES } from "functype/cli"
   export type { TypeData, InterfaceData } from "functype/cli"
   ```

2. **Delete `src/lib/docs/full-interfaces.ts`** — no longer needed, comes from functype.

3. **Keep `src/lib/docs/formatters.ts` unchanged** — remains plain TypeScript with no functype runtime dependency. Update imports to pull `FULL_INTERFACES` from the re-export barrel instead of the deleted file.

4. **Remove version-sniffing code** — the `getFunctypeVersion()` function that walks `node_modules` is no longer needed since `VERSION` comes from the export.

## What Stays the Same

- MCP server formatters remain plain TypeScript (no functype FP imports)
- MCP server's `searchTypes`, `getTypeByName`, `getInterfaceByName` helper functions stay local
- Validator (`compiler-host.ts`, `validate.ts`) unchanged
- All 4 MCP tools (`search_docs`, `get_type_api`, `get_interfaces`, `validate_code`) unchanged

## Data Flow After

```
functype/src/cli/data.ts          (source of truth)
functype/src/cli/full-interfaces.ts  (auto-generated by extract:interfaces)
         |
         v
functype/src/cli/exports.ts       (public barrel, re-exports data only)
         |
         v  (npm dependency)
functype-mcp-server/src/lib/docs/data.ts  (thin re-export)
         |
         v
functype-mcp-server/src/lib/docs/formatters.ts  (local, plain TS)
```

## Update Workflow After

When functype adds new types or methods:

1. Update `src/cli/data.ts` in functype
2. Run `pnpm extract:interfaces` if interfaces changed
3. `pnpm validate` and publish functype
4. Bump functype version in functype-mcp-server
5. `pnpm validate` — done. No manual data copying.
